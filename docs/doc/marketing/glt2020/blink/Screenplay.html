

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GLT2020 “Blink” Presentation Screenplay &mdash; openheating 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="OpenHeating Presentation Ideas" href="../../heating.html" />
    <link rel="prev" title="Pointless Blinking and Switching with Python, libgpiod, and asyncio" href="../blink.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> openheating
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install/dependencies.html">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install/dependencies.html#dbus-pydbus">DBus: pydbus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/dependencies.html#systemd-startup-notification"><cite>systemd</cite> Startup Notification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/dependencies.html#flask">Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/dependencies.html#gradients-interpolation-graphs">Gradients, Interpolation, Graphs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/dependencies.html#gpio-libgpiod">GPIO: <cite>libgpiod</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install/dependencies.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../install/dependencies.html#links">Links</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install/installation.html">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#get-the-source">Get the Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#bootloader">Bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#create-user">Create User</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#openheating-configuration">OpenHeating Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#i2c-onewire-master-config">I2C Onewire Master Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#systemd-unit-generator-and-plant-startup"><cite>systemd</cite> Unit Generator, and Plant Startup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#http-service">HTTP Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#dbus-configuration">DBus Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install/installation.html#finally-startup">Finally: Startup</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../motivation.html">Motivation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../motivation.html#current-goal-keep-my-house-warm">Current Goal: Keep my House Warm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../motivation.html#rant">Rant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../motivation.html#plan">Plan</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faschingbauer/index.html">Faschingbauer Installation Specifics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../faschingbauer/relays.html">Switches/Relays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/relays.html#sainsmart-8-channel-5v-relay-board">Sainsmart 8 Channel 5V Relay Board</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/relays.html#uln2803a-darlington-transistor-array">ULN2803A Darlington Transistor Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/relays.html#raspberry-gpio-usage">Raspberry GPIO Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/relays.html#long-story-short-gpio-relay-mapping">Long Story Short: GPIO/Relay Mapping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/relays.html#miscellaneous">Miscellaneous</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/relays.html#bookmarks-electronics-etc">Bookmarks: Electronics etc.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/relays.html#using-mcp23017">Using MCP23017</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../faschingbauer/thermometers.html">Thermometers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/thermometers.html#sensors-ds18b20">Sensors: DS18B20</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/thermometers.html#cabling">Cabling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/thermometers.html#rj11-telephone-wires">RJ11, Telephone Wires</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/thermometers.html#onewire-caveats">Onewire Caveats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../faschingbauer/thermometers.html#onewire-master-and-stability">Onewire Master and Stability</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/thermometers.html#w1-gpio-bitbanging"><code class="docutils literal notranslate"><span class="pre">w1-gpio</span></code>: Bitbanging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../faschingbauer/thermometers.html#ds2482-800-master-on-i2c">DS2482-800+: Master on I2C</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../faschingbauer/thermometers.html#enable-i2c-on-the-raspi">Enable I2C on the Raspi</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../faschingbauer/thermometers.html#announce-the-i2c-device-to-the-os">Announce the I2C device to the OS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Marketing</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Grazer Linuxtage 2020</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../blink.html">Talk Summary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../blink.html#cv">CV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../blink.html#abstract">Abstract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../blink.html#topics">Topics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../blink.html#use-case">Use Case</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">GLT2020 “Blink” Presentation Screenplay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#led-without-led">LED without LED</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blocking">Blocking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#asyncio-basics"><cite>asyncio</cite> Basics</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#asyncio-basics-py"><code class="docutils literal notranslate"><span class="pre">010-asyncio-basics.py</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="#asyncio-parallel-py"><code class="docutils literal notranslate"><span class="pre">020-asyncio-parallel.py</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#towards-functional">Towards Functional</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#sos-py"><code class="docutils literal notranslate"><span class="pre">030-sos.py</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#gpio">GPIO</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#sos-loop-error-py"><code class="docutils literal notranslate"><span class="pre">040-sos-loop-error.py</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#towards-functional-continued">Towards Functional, Continued</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#decorators-simple-example">Decorators: Simple Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#program-decorator-py"><code class="docutils literal notranslate"><span class="pre">060-program-decorator.py</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#entire-library-of-such-programs">Entire Library of Such Programs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#easy-programming">Easy Programming</a></li>
<li class="toctree-l4"><a class="reference internal" href="#push-button-events">Push-Button Events</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../heating.html">OpenHeating Presentation Ideas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">Miscellaneous Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../misc/dbus.html">D-Bus Things</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../misc/dbus.html#calling-object-methods">Calling Object Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../misc/dbus.html#thermometer-service">Thermometer Service</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../misc/dbus.html#introspection">Introspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../misc/dbus.html#debug-monitor">Debug, Monitor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../misc/panel.html">Panel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../misc/panel.html#hardware">Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../misc/panel.html#autostart">Autostart</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../future/index.html">What the Future Maybe Brings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../future/stack.html">Stacks (Hanging)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../future/stack.html#hotwater-circuit-overtake">Hotwater Circuit Overtake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../future/stack.html#component-documentation">Component Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../future/panel.html">Panel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../future/panel.html#gpio">GPIO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../future/panel.html#uln2803a">ULN2803A</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../future/panel.html#id1">Panel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../future/web.html">Web Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../future/web.html#vue">Vue</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../future/ideas.html">Lots of Vague Ideas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../future/ideas.html#project-structure-cleanup">Project Structure Cleanup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../future/ideas.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../future/ideas.html#more-heatingisms">More Heatingisms</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../github.html">Getting the Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../components/index.html">Components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../components/architecture.html">Architectural Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../components/architecture.html#polling">Polling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/main.html"><code class="docutils literal notranslate"><span class="pre">org.openheating.Main</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../components/main.html#source">Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/main.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/main.html#sample-configuration-file">Sample Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/thermometers.html">Thermometers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../components/thermometers.html#objects-provided">Objects Provided</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/thermometers.html#sample-configuration-file">Sample Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/switches.html"><code class="docutils literal notranslate"><span class="pre">org.openheating.Switches</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../components/switches.html#source">Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/switches.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/switches.html#sample-configuration-file">Sample Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/circuits.html"><code class="docutils literal notranslate"><span class="pre">org.openheating.Circuits</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../components/circuits.html#source">Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/circuits.html#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../components/circuits.html#sample-configuration-file">Sample Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/oil.html">Oil Burner Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/wood.html">Wood Oven Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/room.html">Room Temperature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/boiler.html">Warm Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/dbus-objects.html">D-Bus Objects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulation/index.html">Running Plant Under Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unittests/index.html">Running Unittests</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">openheating</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Marketing</a> &raquo;</li>
        
          <li><a href="../index.html">Grazer Linuxtage 2020</a> &raquo;</li>
        
      <li>GLT2020 “Blink” Presentation Screenplay</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/doc/marketing/glt2020/blink/Screenplay.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="glt2020-blink-presentation-screenplay">
<h1><a class="toc-backref" href="#id9">GLT2020 “Blink” Presentation Screenplay</a><a class="headerlink" href="#glt2020-blink-presentation-screenplay" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#glt2020-blink-presentation-screenplay" id="id9">GLT2020 “Blink” Presentation Screenplay</a></p>
<ul>
<li><p><a class="reference internal" href="#led-without-led" id="id10">LED without LED</a></p></li>
<li><p><a class="reference internal" href="#blocking" id="id11">Blocking</a></p></li>
<li><p><a class="reference internal" href="#asyncio-basics" id="id12"><cite>asyncio</cite> Basics</a></p>
<ul>
<li><p><a class="reference internal" href="#asyncio-basics-py" id="id13"><code class="docutils literal notranslate"><span class="pre">010-asyncio-basics.py</span></code></a></p></li>
<li><p><a class="reference internal" href="#asyncio-parallel-py" id="id14"><code class="docutils literal notranslate"><span class="pre">020-asyncio-parallel.py</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#towards-functional" id="id15">Towards Functional</a></p>
<ul>
<li><p><a class="reference internal" href="#sos-py" id="id16"><code class="docutils literal notranslate"><span class="pre">030-sos.py</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpio" id="id17">GPIO</a></p>
<ul>
<li><p><a class="reference internal" href="#sos-loop-error-py" id="id18"><code class="docutils literal notranslate"><span class="pre">040-sos-loop-error.py</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#towards-functional-continued" id="id19">Towards Functional, Continued</a></p>
<ul>
<li><p><a class="reference internal" href="#decorators-simple-example" id="id20">Decorators: Simple Example</a></p></li>
<li><p><a class="reference internal" href="#program-decorator-py" id="id21"><code class="docutils literal notranslate"><span class="pre">060-program-decorator.py</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#entire-library-of-such-programs" id="id22">Entire Library of Such Programs</a></p></li>
<li><p><a class="reference internal" href="#easy-programming" id="id23">Easy Programming</a></p></li>
<li><p><a class="reference internal" href="#push-button-events" id="id24">Push-Button Events</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="led-without-led">
<h2><a class="toc-backref" href="#id10">LED without LED</a><a class="headerlink" href="#led-without-led" title="Permalink to this headline">¶</a></h2>
<p>No idea what GPIO is, so I mock it up. We’ll get to <a class="reference internal" href="../../../install/dependencies.html#linkref-libgpiod"><span class="std std-ref">libgpiod</span></a> later.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">LED without nothing</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LED_nohw</span><span class="p">:</span>
    <span class="n">COLORS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;31m&#39;</span><span class="p">,</span>
        <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;32m&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yellow&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;33m&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">NO_COLOR</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">COLORS</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span>
    <span class="k">def</span> <span class="nf">on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">+</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">NO_COLOR</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">+</span><span class="s1">&#39;off&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">NO_COLOR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="blocking">
<h2><a class="toc-backref" href="#id11">Blocking</a><a class="headerlink" href="#blocking" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">000-blink-blocking.py</span></code>: blink one LED, using blocking
time.sleep() in the middle</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">001-blink-multiple-mt.py</span></code>: blink multiple LEDs. Like above, but
multiple threads.</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Write those</p>
</div>
<p>Discussion: hmm, multithreading</p>
<ul class="simple">
<li><p>thread termination</p></li>
<li><p>cache thrashing</p></li>
<li><p>locking?</p></li>
</ul>
</div>
<div class="section" id="asyncio-basics">
<h2><a class="toc-backref" href="#id12"><cite>asyncio</cite> Basics</a><a class="headerlink" href="#asyncio-basics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="asyncio-basics-py">
<h3><a class="toc-backref" href="#id13"><code class="docutils literal notranslate"><span class="pre">010-asyncio-basics.py</span></code></a><a class="headerlink" href="#asyncio-basics-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">led</span>
<span class="kn">import</span> <span class="nn">asyncio</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">blink</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

<span class="n">led</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">()</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">blink</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
<p>Discussion:</p>
<ul class="simple">
<li><p>Aha: async, await</p></li>
<li><p>View with <cite>strace</cite></p></li>
<li><p>Discuss epoll (select, poll)</p></li>
</ul>
</div>
<div class="section" id="asyncio-parallel-py">
<h3><a class="toc-backref" href="#id14"><code class="docutils literal notranslate"><span class="pre">020-asyncio-parallel.py</span></code></a><a class="headerlink" href="#asyncio-parallel-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">led</span>
<span class="kn">import</span> <span class="nn">asyncio</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">blink</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

<span class="n">green</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">yellow</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">blink</span><span class="p">(</span><span class="n">led</span><span class="o">=</span><span class="n">green</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
                   <span class="n">blink</span><span class="p">(</span><span class="n">led</span><span class="o">=</span><span class="n">yellow</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                   <span class="n">blink</span><span class="p">(</span><span class="n">led</span><span class="o">=</span><span class="n">red</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">))</span>
</pre></div>
</div>
<p>Discussion:</p>
<ul class="simple">
<li><p>Aha, parallel, whats that?</p></li>
<li><p>strace: look ma, <em>no</em> multithreading</p></li>
<li><p>Discuss <em>cooperative multitasking</em></p>
<ul>
<li><p>Doze 3.11</p></li>
<li><p>No-one should <em>block</em></p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="towards-functional">
<h2><a class="toc-backref" href="#id15">Towards Functional</a><a class="headerlink" href="#towards-functional" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sos-py">
<h3><a class="toc-backref" href="#id16"><code class="docutils literal notranslate"><span class="pre">030-sos.py</span></code></a><a class="headerlink" href="#sos-py" title="Permalink to this headline">¶</a></h3>
<p><strong>SOS</strong></p>
<ul class="simple">
<li><p>3 times fast</p></li>
<li><p>3 times slow</p></li>
<li><p>3 times fast</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">led</span>
<span class="kn">import</span> <span class="nn">asyncio</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">sos</span><span class="p">(</span><span class="n">led</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">led</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">()</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">sos</span><span class="p">(</span><span class="n">led</span><span class="p">))</span>
</pre></div>
</div>
<p>Discussion:</p>
<ul class="simple">
<li><p>Nothing really new here</p></li>
<li><p>Next: <em>SOS</em> in a loop, with sleep in between.</p></li>
<li><p>But first: LEDs in a terminal aren’t so sexy</p>
<ul>
<li><p>Introduce GPIO</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="gpio">
<h2><a class="toc-backref" href="#id17">GPIO</a><a class="headerlink" href="#gpio" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Discuss <code class="docutils literal notranslate"><span class="pre">RPi.GPIO</span></code></p>
<ul class="simple">
<li><p>purely Raspi specific</p></li>
<li><p>Used to map <code class="docutils literal notranslate"><span class="pre">/dev/mem</span></code> -&gt; required root permission</p></li>
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">/dev/gpiomem</span></code> nowadays -&gt; group gpio (ok)</p></li>
<li><p>Events: fired from background thread. Outright crap.</p></li>
</ul>
</div>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>Discuss sysfs gpio</p>
<ul class="simple">
<li><p>File based interface -&gt; simple</p></li>
<li><p>But …</p>
<ul>
<li><p>Events from <code class="docutils literal notranslate"><span class="pre">value</span></code> file -&gt; have to read fast enough when
edge is important</p></li>
<li><p>No event <em>buffering</em> -&gt; event loss</p></li>
<li><p>unmaintained</p></li>
</ul>
</li>
</ul>
</div>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Discuss <a class="reference internal" href="../../../install/dependencies.html#linkref-libgpiod"><span class="std std-ref">libgpiod</span></a></p>
<ul class="simple">
<li><p>Complicated set of ioctls</p></li>
<li><p>Userspace C library</p></li>
<li><p>Associated programs</p>
<ul>
<li><p>Demo</p></li>
</ul>
</li>
<li><p>Binding for Python and C++</p></li>
</ul>
</div>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>loop.add_reader() -&gt; events</p>
</div>
<div class="section" id="sos-loop-error-py">
<h3><a class="toc-backref" href="#id18"><code class="docutils literal notranslate"><span class="pre">040-sos-loop-error.py</span></code></a><a class="headerlink" href="#sos-loop-error-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">led</span>
<span class="kn">import</span> <span class="nn">asyncio</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">sos</span><span class="p">(</span><span class="n">led</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">forever</span><span class="p">(</span><span class="n">coro</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">coro</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">led</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">()</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">forever</span><span class="p">(</span><span class="n">sos</span><span class="p">(</span><span class="n">led</span><span class="p">)))</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>Use GPIO LED from now on</p>
</div>
<p>Error:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./040-sos-loop-error.py
on
... SOS here ...
off
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;./040-sos-loop-error.py&quot;</span>, line <span class="m">33</span>, in &lt;module&gt;
    loop.run_until_complete<span class="o">(</span>forever<span class="o">(</span>sos<span class="o">(</span>led<span class="o">)))</span>
  File <span class="s2">&quot;/usr/lib64/python3.7/asyncio/base_events.py&quot;</span>, line <span class="m">583</span>, in run_until_complete
    <span class="k">return</span> future.result<span class="o">()</span>
  File <span class="s2">&quot;./040-sos-loop-error.py&quot;</span>, line <span class="m">28</span>, in forever
    await coro
RuntimeError: cannot reuse already awaited coroutine
</pre></div>
</div>
<p>Discussion:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forever()</span></code>. problem: coroutine can only be awaited once. discuss
coroutines, yield?, return (-&gt; coroutine termination)</p></li>
<li><p>Aha: need a factory that can “re”create coros</p></li>
</ul>
</div>
</div>
<div class="section" id="towards-functional-continued">
<h2><a class="toc-backref" href="#id19">Towards Functional, Continued</a><a class="headerlink" href="#towards-functional-continued" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decorators-simple-example">
<h3><a class="toc-backref" href="#id20">Decorators: Simple Example</a><a class="headerlink" href="#decorators-simple-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">math</span>


<span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;args:&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="s1">&#39;, kwargs:&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@debug</span>
<span class="k">def</span> <span class="nf">hypotenuse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Discussion:</p>
<ul class="simple">
<li><p>magic: “&#64;”. Same as saying <code class="docutils literal notranslate"><span class="pre">debug(hypotenuse)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wrapper</span></code> <em>wraps</em> <code class="docutils literal notranslate"><span class="pre">fun</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span></code> is said to be <em>in the closure</em></p></li>
</ul>
<p>More evident closure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">hardwired_printer</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_print</span><span class="p">():</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">_print</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">=</span> <span class="n">hardwired_printer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span>
<span class="go">&lt;function hardwired_printer.&lt;locals&gt;._print at 0x7fb31dcf18c0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span><span class="p">()</span>
<span class="go">args (1, 2, 3) kwargs {}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">hardwired_printer</span><span class="p">(</span><span class="mi">666</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span><span class="p">()</span>
<span class="go">args (666,) kwargs {&#39;answer&#39;: 42}</span>
</pre></div>
</div>
</div>
<div class="section" id="program-decorator-py">
<h3><a class="toc-backref" href="#id21"><code class="docutils literal notranslate"><span class="pre">060-program-decorator.py</span></code></a><a class="headerlink" href="#program-decorator-py" title="Permalink to this headline">¶</a></h3>
<p>So what’s the problem?</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sos()</span></code> terminates -&gt; cannot await it a second time</p></li>
</ul>
<p>Solution:</p>
<ul class="simple">
<li><p>Need something that <em>remembers</em> the parameters -&gt; decorator</p></li>
<li><p>That something must be “launchable”</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>


<span class="kn">import</span> <span class="nn">led</span>
<span class="kn">import</span> <span class="nn">asyncio</span>


<span class="k">def</span> <span class="nf">program</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">creator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">launch</span><span class="p">():</span>
            <span class="c1"># create a coroutine, readily wrapped in a asyncio Future</span>
            <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">launch</span>
    <span class="k">return</span> <span class="n">creator</span>

<span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">sos</span><span class="p">(</span><span class="n">led</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">led</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

<span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">forever</span><span class="p">(</span><span class="o">*</span><span class="n">progs</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">progs</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">p</span><span class="p">()</span>
            <span class="k">await</span> <span class="n">current</span>

<span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="n">secs</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span>

<span class="n">led</span> <span class="o">=</span> <span class="n">led</span><span class="o">.</span><span class="n">LED_nohw</span><span class="p">()</span>
<span class="n">prog</span> <span class="o">=</span> <span class="n">forever</span><span class="p">(</span><span class="n">sos</span><span class="p">(</span><span class="n">led</span><span class="p">),</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">prog</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="entire-library-of-such-programs">
<h2><a class="toc-backref" href="#id22">Entire Library of Such Programs</a><a class="headerlink" href="#entire-library-of-such-programs" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">sequence</span><span class="p">(</span><span class="o">*</span><span class="n">progs</span><span class="p">):</span>
    <span class="n">current</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">prog</span> <span class="ow">in</span> <span class="n">progs</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">launch</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">current</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">n_times</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">prog</span><span class="p">):</span>
    <span class="n">current</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">launch</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">current</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">forever</span><span class="p">(</span><span class="o">*</span><span class="n">progs</span><span class="p">):</span>
    <span class="n">current</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">prog</span> <span class="ow">in</span> <span class="n">progs</span><span class="p">:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">launch</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">current</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span> 
            <span class="n">current</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="o">*</span><span class="n">progs</span><span class="p">):</span>
    <span class="s1">&#39;run progs in parallel and wail until all are done&#39;</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">p</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">progs</span><span class="p">]))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">task</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">any</span><span class="p">(</span><span class="o">*</span><span class="n">progs</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">launch</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span> <span class="k">for</span> <span class="n">prog</span> <span class="ow">in</span> <span class="n">progs</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@program</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">wait_button</span><span class="p">(</span><span class="n">button</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">button</span><span class="o">.</span><span class="n">state_changed</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="easy-programming">
<h2><a class="toc-backref" href="#id23">Easy Programming</a><a class="headerlink" href="#easy-programming" title="Permalink to this headline">¶</a></h2>
<p>Examples …</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">forever</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">blink</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">green</span><span class="o">.</span><span class="n">led</span><span class="p">)),</span>
        <span class="nb">any</span><span class="p">(</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">blink</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">yellow</span><span class="o">.</span><span class="n">led</span><span class="p">)),</span>
        <span class="nb">any</span><span class="p">(</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">blink</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">red</span><span class="o">.</span><span class="n">led</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="push-button-events">
<h2><a class="toc-backref" href="#id24">Push-Button Events</a><a class="headerlink" href="#push-button-events" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id7">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>Live-hacking: debounce buttons</p></li>
<li><p>wait_button()</p></li>
<li><p>subprocess_shell()</p></li>
<li><p>http_get()</p></li>
<li><p>blink.open_url()</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../heating.html" class="btn btn-neutral float-right" title="OpenHeating Presentation Ideas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../blink.html" class="btn btn-neutral float-left" title="Pointless Blinking and Switching with Python, libgpiod, and asyncio" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Jörg Faschingbauer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>